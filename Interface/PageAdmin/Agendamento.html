<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamentos com Serviços</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <div class="container">
        <h1>Agendamentos com Serviços</h1>

        <!-- Campos de Filtro -->
        <div class="form-group">
            <label for="filtroTipo">Escolha o filtro desejado</label>
            <select class="form-control" id="filtroTipo">
                <option value="" disabled selected>Escolha um filtro</option>
                <option value="id">ID</option>
                <option value="nome">NOME</option>
            </select>
        </div>
        
        <div class="form-group" id="clienteIdFilterGroup" style="display: none;">
            <label for="clienteIdFilter">Filtrar por ID do Cliente</label>
            <input type="number" class="form-control" id="clienteIdFilter">
        </div>
        <div class="form-group" id="clienteNomeFilterGroup" style="display: none;">
            <label for =  "clienteNomeFilter">Filtrar por Nome do Cliente</label>
            <input type="text" class="form-control" id="clienteNomeFilter">
        </div>
        <button class="btn btn-primary" onclick="filtrarAgendamentos()">Filtrar</button>
        <button class="btn btn-primary" onclick="verTodosClientes()">Ver Todos os Clientes</button>
        <button class="btn btn-primary" onclick="concluirServico()">Concluir Serviço </button>
        <button class="btn btn-primary" onclick="infoClientes()">infoClientes </button>


        <!-- Tabela de Agendamentos com Serviços -->
        <h2>Agendamentos com Serviços</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>ID AGENDAMENTO</th>
                    <th>NOME DO CLIENTE</th>
                    <th>Data e Hora do Agendamento</th>
                    <th>Nome do Serviço</th>
                    <th>Status de Pagamento</th>
                    <th>Status de Agendamento</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="agendamentosComServicosTable">
                <!-- Os dados dos agendamentos com serviços serão exibidos aqui -->
            </tbody>
        </table>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.24.0/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script>

function concluirServico() {
    // Redireciona para a página que lista todos os clientes
    window.location.href = "../Trash/concluirServico.html"; // Substitua pelo caminho correto
}

function infoClientes() {
    // Redireciona para a página que lista todos os clientes
    window.location.href = "../Trash/informacoes.html"; // Substitua pelo caminho correto
}

function verTodosClientes() {
    // Redireciona para a página que lista todos os clientes
    window.location.href = "../PageCliente/getCliente.html"; // Substitua pelo caminho correto
}

        // Atualiza os campos de filtro com base na escolha do filtro
        document.getElementById("filtroTipo").addEventListener("change", function () {
            const filtroTipo = this.value;
            if (filtroTipo === "id") {
                document.getElementById("clienteIdFilterGroup").style.display = "block";
                document.getElementById("clienteNomeFilterGroup").style.display = "none";
            } else if (filtroTipo === "nome") {
                document.getElementById("clienteIdFilterGroup").style.display = "none";
                document.getElementById("clienteNomeFilterGroup").style.display = "block";
            }
        });

        // Função para formatar a data no formato "dd/mm/yyyy"
        function formatarData(data) {
            return moment(data).format('DD/MM/YYYY');
        }

        // Recuperar dados de agendamentos com serviços por meio de uma solicitação Axios
        axios.get("http://localhost:8080/agendamentos-com-servicos")
            .then(function (response) {
                const agendamentosComServicosTable = document.getElementById("agendamentosComServicosTable");
                response.data.forEach(function (agendamento) {
                    agendamentosComServicosTable.innerHTML += `
                        <tr>
                            <td>${agendamento.id}</td>
                            <td>${agendamento.Cliente.nome}</td>
                            <td>${formatarData(agendamento.dataHoraAgendamento)}</td>
                            <td>${agendamento.Servico.nomeServico}</td>
                            <td>${agendamento.StatusDePagamento}</td>
                            <td>${agendamento.StatusDeConsulta}</td>
                            <!-- Altere o botão "Editar Agendamento" para um link âncora -->
                            <td>
                                <a class="btn btn-primary" href="editar-agendamento.html?id=${agendamento.id}">Editar Agendamento</a>
                                <a class="btn btn-secondary" href="../PageCliente/editar-cliente.html?id=${agendamento.idCliente}">Editar Cliente</a>
                            </td>
                        </tr>
                    `;
                });
            })
            .catch(function (error) {
                console.error("Erro ao buscar agendamentos com serviços:", error);
            });

        // Função para editar o agendamento
        function editarAgendamento(agendamentoId) {
            // Adicione aqui a lógica para editar o agendamento com o ID fornecido
            console.log("Editar agendamento com ID: " + agendamentoId);
        }

        // Função para editar o cliente
        function editarCliente(clienteId) {
            // Adicione aqui a lógica para editar o cliente com o ID fornecido
            console.log("Editar cliente com ID: " + clienteId);
        }

        // Função para filtrar agendamentos com base no ID do cliente e nome do cliente
        function filtrarAgendamentos() {
            const filtroTipo = document.getElementById("filtroTipo").value;
            const clienteIdFilter = document.getElementById("clienteIdFilter").value;
            const clienteNomeFilter = document.getElementById("clienteNomeFilter").value;

            let filtroUrl = "http://localhost:8080/agendamentos-filtrados?";

            if (filtroTipo === "id") {
                filtroUrl += `clienteId=${clienteIdFilter}`;
            } else if (filtroTipo === "nome") {
                filtroUrl += `nomeCliente=${clienteNomeFilter}`;
            }

            axios.get(filtroUrl)
                .then(function (response) {
                    const agendamentosComServicosTable = document.getElementById("agendamentosComServicosTable");
                    agendamentosComServicosTable.innerHTML = ""; // Limpa a tabela antes de adicionar os resultados filtrados

                    response.data.forEach(function (agendamento) {
                        agendamentosComServicosTable.innerHTML += `
                            <tr>
                                <td>${agendamento.id}</td>
                                <td>${agendamento.Cliente.nome}</td>
                                <td>${formatarData(agendamento.dataHoraAgendamento)}</td>
                                <td>${agendamento.Servico.nomeServico}</td>
                                <td>${agendamento.StatusDePagamento}</td>
                                <td>${agendamento.StatusDeConsulta}</td>
                                <td>
                                    <a class="btn btn-primary" href="editar-agendamento.html?id=${agendamento.id}">Editar Agendamento</a>
                                    <button class="btn btn-secondary" onclick="editarCliente(${agendamento.idCliente})">Editar Cliente</button>
                                </td>
                            </tr>
                        `;
                    });
                })
                .catch(function (error) {
                    console.error("Erro ao filtrar agendamentos:", error);
                });
        }
    </script>
</body>

</html>
